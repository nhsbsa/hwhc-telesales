{% extends 'layout-fullscreen.html' %}

{% set pageName = 'Certificate' %}

{% block beforeContent %}
 {{ backLink({
    href: 'javascript:history.back();',
    text: 'Back'
  }) }}
{% endblock %}

{% block content %}


  {% if data.patientID %}
    {% set patient = data.patientID | getPatientData %}
  {% endif %}

  {#{ patient | dump }#}

  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">
      <h1 class="nhsuk-heading-m">{{ pageName }} {{ patient.certificateReference or '56 913 186 386' }} - {{ patient.lastName or 'Smith' }}, {{ patient.firstName or 'Jane' }} 
        {{ ( patient.certificateType or 'matex' ) | getCertificateTypeTextOrTag( true ) | safe }}
        {{ ( patient.status or 'active' ) | getStatusTextOrTag( true ) | safe }}
      </h1>
    </div>
  </div>

  <div class="nhsuk-grid-row">

    <div class="nhsuk-grid-column-one-third">

      {{ card({
        heading: "Certificate details",
        headingLevel: "2",
        headingClasses: "nhsuk-heading-s",
        description: summaryList({
          classes: "summary-list--single-line",
          rows: [
            {
              key: { text: 'Reference' },
              value: { text: patient.certificateReference or '56 913 186 386' }
            },
            {
              key: { text: 'Type' },
              value: { html: ( patient.certificateType or 'matex' ) | getCertificateTypeTextOrTag( true ) }
            },
            {
              key: { text: 'Status' },
              value: { html: ( patient.status or 'active' ) | getStatusTextOrTag( true ) }
            },
            {
              key: { text: 'Channel' },
                value: { text: patient.applicationChannel or 'digital' | getApplicationChannelText }
            },
            {
              key: { text: 'Fulfilment' },
              value: { text: patient.certificateFulfilment or 'email' | getCertificateFulfilmentText }
            },
            {
              key: {
                text: "Start date"
              },
              value: {
                html: "25 November 2025"
              }
            },
            {
              key: {
                text: "Expiry date"
              },
              value: {
                html: "24 November 2026"
              }
            },
            {
              key: {
                text: "Application date"
              },
              value: {
                html: "25 November 2025"
              }
            }
          ]
        })

      }) }}
    
    </div>

    


    <div class="nhsuk-grid-column-one-third">
      {{ card({
        heading: "Personal details",
        headingLevel: "2",
        headingClasses: "nhsuk-heading-s",
        description: summaryList({
          classes: "summary-list--single-line",
          rows: [
            {
              key: { text: 'Last name' },
              value: { text: patient.lastName or 'Smith' }
            },
            {
              key: { text: 'First name' },
              value: { text: patient.firstName or 'Jane' }
            },
            {
              key: {
                text: "Address"
              },
              value: {
                html: ""
              }
            },
            {
              key: {
                text: "Postcode"
              },
              value: {
                html: "TR1 10TS"
              }
            },
            {
              key: {
                text: "Telephone number"
              },
              value: {
                html: "07700 123 456"
              }
            },
            {
              key: {
                text: "Date of birth"
              },
              value: {
                html: "24 July 1997"
              }
            },
            {
              key: {
                text: "NHS number"
              },
              value: {
                html: "123 456 7890"
              }
            },
            {
              key: {
                text: "Email address"
              },
              value: {
                html: "jane.smith@example.com"
              }
            },
            {
              key: {
                text: "Child's due or birth date",
                classes: "wrap-key"
              },
              value: {
                html: "25 November 2025"
              }
            }
          ]
        })
        +
        button({
          text: "Edit personal details",
          classes: "nhsuk-button--secondary nhsuk-u-margin-top-5",
          href: "edit-personal-details"
        })
      }) }}
    </div>


    <div class="nhsuk-grid-column-one-third">

      <h2 class="nhsuk-u-visually-hidden">Certificate timeline</h2>

        <!-- Import from NHS App frontend -->
        {% from 'nhsapp/components/timeline/macro.njk' import nhsappTimeline %}

        <!-- {{ nhsappTimeline({
          items: [
            {
              headingText: 'Application accepted and awaiting print',
              html: '<span class="nhsuk-body-s">23 November 2025, 12:32</span>',
              active: true
            },
            {
              headingText: 'Application scanned',
              html: '<span class="nhsuk-body-s">23 November 2025, 08:30</span>'
            }
          ]
        }) }} -->

        {% from "tabs/macro.njk" import tabs %}
        {% from "tables/macro.njk" import table %}


        {% set NotesContent %}
        <div class="scroll-container">
        {{ nhsappTimeline({
          items: [
            {
              headingText: '22 December 2025 2:30pm',
              html: '
                <p class="nhsuk-u-margin-bottom-1">Maria Li (Customer contact advisor)</p>
                <p class="nhsuk-u-margin-bottom-1">"Applicant phoned to confirm address change."</p>
              ',
              active: true
            }
          ]
        }) }}
        </div>
        {% endset -%} 

        {% set EventsContent %}
          <div class="scroll-container">
          {{ nhsappTimeline({
            items: [
            {
              headingText: 'Postcode updated',
              html: '
                <ul class="nhsuk-list nhsuk-list--bullet nhsuk-u-margin-top-1">
                  <li>Postcode: "NE15 8NY" TO "TR1 10TS"</li>
                </ul>
                <p class="nhsuk-body-s nhsuk-u-margin-top-1">22 December 2025 2:30pm</p>
              ',
              active: true
            },
            {
              headingText: 'Application approved',
              html: '
                <ul class="nhsuk-list nhsuk-list--bullet nhsuk-u-margin-top-1">
                  <li>Status: Reviewing TO Accepted</li>
                </ul>
                <p class="nhsuk-body-s nhsuk-u-margin-top-1">23 November 2025 04:30pm</p>
              '
            },
            {
              headingText: 'Application processed',
              html: '
                <ul class="nhsuk-list nhsuk-list--bullet nhsuk-u-margin-top-1">
                  <li>Status: Processing TO Reviewing</li>
                </ul>
                <p class="nhsuk-body-s nhsuk-u-margin-top-1">23 November 2025 12:32pm</p>
              '
            },
            {
              headingText: 'Application scanned',
              html: '
                <ul class="nhsuk-list nhsuk-list--bullet nhsuk-u-margin-top-1">
                  <li>Status: Pending TO Processing</li>
                </ul>
                <p class="nhsuk-body-s nhsuk-u-margin-top-1">21 November 2025 08:30am</p>
                '
            }
            ]
          }) }}
        </div>

        {% endset -%} 

        {% set FullLogContent %}
        <div class="scroll-container">
        {{ nhsappTimeline({
          items: [
          {
            headingText: 'Note added',
            html: '
              <p class="nhsuk-u-margin-bottom-1">Maria Li (Customer contact advisor)</p>
              <p class="nhsuk-u-margin-bottom-1">"Applicant phoned to confirm address change."</p>
              <p class="nhsuk-body-s nhsuk-u-margin-top-1">22 December 2025 2:30pm</p>
            ',
            active: true
          },
          {
            headingText: 'Postcode updated',
            html: '
              <p class="nhsuk-u-margin-bottom-1">Maria Li (Customer contact advisor)</p>
              <ul class="nhsuk-list nhsuk-list--bullet nhsuk-u-margin-top-1">
                <li>Postcode: "NE15 8NY" TO "TR1 10TS"</li>
              </ul>
              <p class="nhsuk-body-s nhsuk-u-margin-top-1">22 December 2025 2:30pm</p>
            '
          },
            {
              headingText: 'Application approved',
              html: '
                <p class="nhsuk-u-margin-bottom-1">John Smith (Applications processor)</p>
                <ul class="nhsuk-list nhsuk-list--bullet nhsuk-u-margin-top-1">
                  <li>Status: Reviewing TO Accepted</li>
                </ul>
                <p class="nhsuk-body-s nhsuk-u-margin-top-1">23 November 2025 04:30pm</p>
              '
            },
            {
              headingText: 'Application processed',
              html: '
                <p class="nhsuk-u-margin-bottom-1">John Smith (Applications processor)</p>
                <ul class="nhsuk-list nhsuk-list--bullet nhsuk-u-margin-top-1">
                  <li>Status: Processing TO Reviewing</li>
                </ul>
                <p class="nhsuk-body-s nhsuk-u-margin-top-1">23 November 2025 12:32pm</p>
              '
            },
            {
              headingText: 'Application scanned',
              html: '
                <ul class="nhsuk-list nhsuk-list--bullet nhsuk-u-margin-top-1">
                  <li>Status: Pending TO Processing</li>
                </ul>
                <p class="nhsuk-body-s nhsuk-u-margin-top-1">21 November 2025 08:30am</p>
                '
            }
          ]
        }) }}
      </div>

          {% endset -%} 


        {{ tabs({
          items: [
          {
            label: "Notes",
            id: "notes",
            panel: {
              html: NotesContent
            }
          },
            {
              label: "Events",
              id: "events",
              panel: {
                html: EventsContent
              }
            },
            {
              label: "Full log",
              id: "full-log",
              panel: {
                html: FullLogContent
                }
              }
          ]
        }) }}

      </div>  
    </div>


<div class="nhsuk-grid-row-buttons">

    {{ button({
      text: 'Reissue certificate',
      href: "reissue"
    }) }}

    {{ button({
      classes: "nhsuk-button--secondary-solid",
      text: 'Cancel',
      href: "../search"
    }) }}

</div>


    <!-- Summary list card styling -->
    <style>
      /* --------------------------------------------------- */
      /* Base (default) layout: applies to 426px–1023px & >1024px */
      /* --------------------------------------------------- */

      .summary-list--single-line {
        margin-bottom: 0;
      }

      .summary-list--single-line .nhsuk-summary-list__row {
        display: flex;
        flex-wrap: nowrap;
        align-items: flex-start;
      }

      .summary-list--single-line .nhsuk-summary-list__key {
        flex: 0 0 auto;
        white-space: nowrap;
        margin-right: 5rem;
      }

      .summary-list--single-line .nhsuk-summary-list__value {
        flex: 1 1 auto;
        min-width: 0;
        white-space: normal;
        overflow-wrap: anywhere;
        word-break: break-word;
      }

      .summary-list--single-line .wrap-key {
        white-space: normal;
      }

      .summary-list--single-line .nhsuk-summary-list__row--no-border {
        display: flex;
        justify-content: space-between;
        flex-wrap: nowrap;
        margin-top: 1rem;
      }

      .summary-list--single-line .nhsuk-summary-list__row--no-border 
        .nhsuk-summary-list__key,
      .summary-list--single-line .nhsuk-summary-list__row--no-border 
        .nhsuk-summary-list__value {
        flex: 0 0 auto;
        margin: 0;
      }

      .nhsuk-grid-row-buttons .nhsuk-button--secondary {
          margin-left: 1rem;
      }

      /* --------------------------------------------------- */
      /* STACKING BREAKPOINT 1 — small screens (≤425px)      */
      /* --------------------------------------------------- */
      @media (max-width: 425px) {

        .summary-list--single-line .nhsuk-summary-list__row {
          flex-direction: column;
          align-items: flex-start;
          gap: 0.25rem;
          padding-bottom: 0.5rem;
        }

        .summary-list--single-line .nhsuk-summary-list__key {
          margin: 0;
        }

        .summary-list--single-line .nhsuk-summary-list__row--no-border {
          flex-direction: column;
          align-items: stretch;
          gap: 0.5rem;
        }
      }


      /* --------------------------------------------------- */
      /* STACKING BREAKPOINT 2 — special case: 1024px only   */
      /* --------------------------------------------------- */
      @media (min-width: 1024px) and (max-width: 1024px) {

        .summary-list--single-line .nhsuk-summary-list__row {
          flex-direction: column;
          align-items: flex-start;
          gap: 0.25rem;
          padding-bottom: 0.5rem;
        }

        .summary-list--single-line .nhsuk-summary-list__key {
          margin: 0;
        }

        .summary-list--single-line .nhsuk-summary-list__row--no-border {
          flex-direction: column;
          align-items: stretch;
          gap: 0.5rem;
        }

        .summary-list--single-line .wrap-key {
          white-space: nowrap;
      }

      .nhsuk-tabs__panel {
        height: 1000px;
      }

      .scroll-container {
        min-height: 910px !important;
        overflow-y: auto;
        }
      }
      
      /* --------------------------------------------------- */
      /* Same height columns — Desktop only */
      /* --------------------------------------------------- */
      @media (min-width: 1024px) {

        .nhsuk-grid-row {
          display: flex ;
          align-items: stretch;
        }

        .nhsuk-grid-row > .nhsuk-grid-column-one-third {
          display: flex;
          flex-direction: column;
        }

        .nhsuk-grid-row .nhsuk-card {
          display: flex;
          flex-direction: column;
          height: 100%;
        }

        .nhsuk-grid-row .nhsuk-card__content {
          flex: 1 1 auto;
        }

        .nhsuk-grid-row-buttons .nhsuk-button--secondary-solid {
          margin-left: 1rem;
        }

        .scroll-container {
          max-height: calc(100vh - 265px);
          min-height: 0;
          overflow-y: auto;
        }


      }


    </style>

{% endblock %}