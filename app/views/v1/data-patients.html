{% extends 'layout.html' %}

{% set pageName = 'Data used in this prototype' %}

{% block content %}

  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">

          <h1 class="nhsuk-heading-l">{{ pageName }}</h1>

    </div>
  </div>

  <div class="nhsuk-grid-row">

    <div class="nhsuk-grid-column-one-half">
        <h2 class="nhsuk-heading-m">Certificate types used</h2>
        {{ summaryList({
           rows: [
             {
               key: { text: 'matex' | getCertificateTypeTextOrTag },
               value: { html: 'matex' | getCertificateTypeTextOrTag( true ) }
             },
             {
               key: { text: 'hrtppc' | getCertificateTypeTextOrTag },
               value: { html: 'hrtppc' | getCertificateTypeTextOrTag( true ) }
             }
           ]
         }) }}
    </div>

    <div class="nhsuk-grid-column-one-half">
        <h2 class="nhsuk-heading-m">Statuses used</h2>
         {{ summaryList({
           rows: [
             {
               key: { text: 'processing' | getStatusTextOrTag },
               value: { html: 'processing' | getStatusTextOrTag( true ) }
             },
             {
               key: { text: 'reviewing' | getStatusTextOrTag },
               value: { html: 'reviewing' | getStatusTextOrTag( true ) }
             },
             {
               key: { text: 'accepted' | getStatusTextOrTag },
               value: { html: 'accepted' | getStatusTextOrTag( true ) }
             },
             {
               key: { text: 'active' | getStatusTextOrTag },
               value: { html: 'active' | getStatusTextOrTag( true ) }
             },
             {
               key: { text: 'expired' | getStatusTextOrTag },
               value: { html: 'expired' | getStatusTextOrTag( true ) }
             }
           ]
         }) }}
    </div>
  </div>
  

          

          
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">


          {% set filteredRows = '' | getPatientData | getTableRows %}

          {% if ( filteredRows.length > 0 ) %}

            {{ table({
              panel: false,
              caption: 'Exemptions',
              firstCellIsHeader: false,
              responsive: true,
              tableClasses: 'patient-table',
              head: '' | getTableHeadRows,
              rows: filteredRows
            }) }}

            {{ pagination( '' | getPaginationLinks ) }}

          {% else %}

            {{ insetText({
              text: 'No exemptions found'
            }) }}

          {% endif %}


          <p id="certificateTypes" class="nhsuk-u-visually-hidden">{% for type in data[version].certificateTypes %}{% if loop.index0 !== 0 %},{% endif %}{{ type }}{% endfor %}</p>

          <script>

            const DataGenerator = (function(){

              //
              // NAMES
              // Not real names
              //
              const names = [
                { firstName: 'Olivia', lastName: 'Smith' },
                { firstName: 'Amelia', lastName: 'Jones' },
                { firstName: 'Isla', lastName: 'Taylor' },
                { firstName: 'Ava', lastName: 'Brown' },
                { firstName: 'Emily', lastName: 'Williams' },
                { firstName: 'Sophia', lastName: 'Wilson' },
                { firstName: 'Mia', lastName: 'Davies' },
                { firstName: 'Ella', lastName: 'Evans' },
                { firstName: 'Grace', lastName: 'Thomas' },
                { firstName: 'Lily', lastName: 'Roberts' },
                { firstName: 'Freya', lastName: 'Johnson' },
                { firstName: 'Charlotte', lastName: 'Lewis' },
                { firstName: 'Isabella', lastName: 'Walker' },
                { firstName: 'Daisy', lastName: 'Hall' },
                { firstName: 'Evie', lastName: 'Clarke' },
                { firstName: 'Phoebe', lastName: 'Allen' },
                { firstName: 'Sophie', lastName: 'Young' },
                { firstName: 'Harper', lastName: 'King' },
                { firstName: 'Millie', lastName: 'Wright' },
                { firstName: 'Ella-Rose', lastName: 'Green' },
                { firstName: 'Poppy', lastName: 'Baker' },
                { firstName: 'Ruby', lastName: 'Adams' },
                { firstName: 'Chloe', lastName: 'Mitchell' },
                { firstName: 'Sienna', lastName: 'Turner' },
                { firstName: 'Willow', lastName: 'Carter' },
                { firstName: 'Jessica', lastName: 'Morris' },
                { firstName: 'Matilda', lastName: 'Hughes' },
                { firstName: 'Elsie', lastName: 'Ward' },
                { firstName: 'Rosie', lastName: 'Price' },
                { firstName: 'Aria', lastName: 'Cooper' },
                { firstName: 'Layla', lastName: 'Bailey' },
                { firstName: 'Luna', lastName: 'Parker' },
                { firstName: 'Hannah', lastName: 'Phillips' },
                { firstName: 'Zara', lastName: 'Bennett' },
                { firstName: 'Florence', lastName: 'Cox' },
                { firstName: 'Maya', lastName: 'Richardson' },
                { firstName: 'Esme', lastName: 'Gray' },
                { firstName: 'Ivy', lastName: 'Ross' },
                { firstName: 'Arabella', lastName: 'Bell' },
                { firstName: 'Evelyn', lastName: 'Cook' },
                { firstName: 'Thea', lastName: 'Watson' },
                { firstName: 'Alice', lastName: 'Sanders' },
                { firstName: 'Emma', lastName: 'Harrison' },
                { firstName: 'Lottie', lastName: 'Coleman' },
                { firstName: 'Amber', lastName: 'Murphy' },
                { firstName: 'Scarlett', lastName: 'Graham' },
                { firstName: 'Bonnie', lastName: 'Stevens' },
                { firstName: 'Imogen', lastName: 'Simpson' },
                { firstName: 'Harriet', lastName: 'Butler' },
                { firstName: 'Eleanor', lastName: 'Chapman' },
                { firstName: 'Aisha', lastName: 'Ali' },
                { firstName: 'Sofia', lastName: 'Hussain' },
                { firstName: 'Amira', lastName: 'Khan' },
                { firstName: 'Leah', lastName: 'Begum' },
                { firstName: 'Niamh', lastName: 'Oâ€™Connor' },
                { firstName: 'Aoife', lastName: 'Kelly' },
                { firstName: 'Erin', lastName: 'McCarthy' },
                { firstName: 'Orla', lastName: 'Doyle' },
                { firstName: 'Cerys', lastName: 'Griffiths' },
                { firstName: 'Megan', lastName: 'Rees' },
                { firstName: 'Ffion', lastName: 'Evans' },
                { firstName: 'Eilidh', lastName: 'MacDonald' },
                { firstName: 'Skye', lastName: 'Fraser' },
                { firstName: 'Maisie', lastName: 'Armstrong' },
                { firstName: 'Penelope', lastName: 'Hunter' },
                { firstName: 'Clara', lastName: 'Lawrence' },
                { firstName: 'Beatrice', lastName: 'Spencer' },
                { firstName: 'Nancy', lastName: 'Rogers' },
                { firstName: 'Annabelle', lastName: 'Watts' },
                { firstName: 'Heidi', lastName: 'Henderson' },
                { firstName: 'Rose', lastName: 'Palmer' },
                { firstName: 'Lara', lastName: 'Nicholson' },
                { firstName: 'Julia', lastName: 'Gardner' },
                { firstName: 'Ada', lastName: 'Newton' },
                { firstName: 'Summer', lastName: 'Reed' },
                { firstName: 'Victoria', lastName: 'Harvey' },
                { firstName: 'Maria', lastName: 'Fernandez' },
                { firstName: 'Elena', lastName: 'Silva' },
                { firstName: 'Leila', lastName: 'Patel' },
                { firstName: 'Fatima', lastName: 'Iqbal' },
                { firstName: 'Jasmine', lastName: 'Ahmed' },
                { firstName: 'Nadia', lastName: 'Rashid' },
                { firstName: 'Tara', lastName: 'Paterson' },
                { firstName: 'Bethany', lastName: 'Foster' },
                { firstName: 'Lauren', lastName: 'Fox' },
                { firstName: 'Georgia', lastName: 'Grant' },
                { firstName: 'Abigail', lastName: 'Murray' },
                { firstName: 'Ella-May', lastName: 'West' },
                { firstName: 'Robyn', lastName: 'Matthews' },
                { firstName: 'Kayla', lastName: 'Holmes' },
                { firstName: 'Lydia', lastName: 'Walsh' },
                { firstName: 'Alexandra', lastName: 'Page' },
                { firstName: 'Natalie', lastName: 'Jordan' },
                { firstName: 'Beth', lastName: 'Barrett' },
                { firstName: 'Mollie', lastName: 'Hayes' },
                { firstName: 'Francesca', lastName: 'Cunningham' },
                { firstName: 'Amelie', lastName: 'Barber' },
                { firstName: 'Lucia', lastName: 'Knight' },
                { firstName: 'Eden', lastName: 'Parsons' },
                { firstName: 'Tilly', lastName: 'Bates' },
                { firstName: 'Holly', lastName: 'Day' },
                { firstName: 'Indie', lastName: 'Francis' },
                { firstName: 'Hope', lastName: 'Burton' }
              ];

              //
              // ADDRESSES
              // They're entirely fake
              //
              const addresses = [
                {"buildingNumber":"12","streetName":"Maple Grove","locality":"Ashford Hill","postTown":"Reading","county":"Berkshire","postcode":"RG4 8ZT"},
                {"buildingNumber":"44","streetName":"Bramley Road","locality":"East Mere","postTown":"Norwich","county":"Norfolk","postcode":"NR3 5QN"},
                {"buildingNumber":"7","streetName":"Kestrel Close","locality":"Winterfold","postTown":"Guildford","county":"Surrey","postcode":"GU3 9LP"},
                {"buildingNumber":"82","streetName":"Oakfield Lane","locality":"Hilltop View","postTown":"Exeter","county":"Devon","postcode":"EX2 7SJ"},
                {"buildingNumber":"19","streetName":"Crown Street","locality":"Millbridge","postTown":"Plymouth","county":"Devon","postcode":"PL6 1TD"},
                {"buildingNumber":"5","streetName":"Linton Walk","locality":"Southgate Park","postTown":"Crawley","county":"West Sussex","postcode":"RH11 4XW"},
                {"buildingNumber":"63","streetName":"Riverstone Court","locality":"Longmead","postTown":"Taunton","county":"Somerset","postcode":"TA2 3UP"},
                {"buildingNumber":"28","streetName":"Birch Avenue","locality":"Northcrest","postTown":"Leicester","county":"Leicestershire","postcode":"LE5 8YU"},
                {"buildingNumber":"90","streetName":"Fernbrook Drive","locality":"Westerleigh","postTown":"Bath","county":"Somerset","postcode":"BA2 9PF"},
                {"buildingNumber":"14","streetName":"Windsor Rise","locality":"Redford","postTown":"Derby","county":"Derbyshire","postcode":"DE1 4SX"},

                {"buildingNumber":"51","streetName":"Hawthorne Road","locality":"Claymere","postTown":"Chester","county":"Cheshire","postcode":"CH4 2MB"},
                {"buildingNumber":"3","streetName":"Mallow Street","locality":"Eastwood Vale","postTown":"Nottingham","county":"Nottinghamshire","postcode":"NG5 3JU"},
                {"buildingNumber":"76","streetName":"Peach Tree Way","locality":"Brookfell","postTown":"York","county":"North Yorkshire","postcode":"YO3 6AP"},
                {"buildingNumber":"24","streetName":"Millstream Row","locality":"Havenfield","postTown":"Lincoln","county":"Lincolnshire","postcode":"LN2 8FP"},
                {"buildingNumber":"37","streetName":"Weavers Lane","locality":"Northgate","postTown":"Wolverhampton","county":"West Midlands","postcode":"WV4 3TT"},
                {"buildingNumber":"11","streetName":"Rose Mews","locality":"Kingswell","postTown":"Oxford","county":"Oxfordshire","postcode":"OX3 9DQ"},
                {"buildingNumber":"8","streetName":"Elmbrook Gardens","locality":"Gransfield","postTown":"Peterborough","county":"Cambridgeshire","postcode":"PE2 7QF"},
                {"buildingNumber":"65","streetName":"Pine Hollow","locality":"Northbrook","postTown":"Cheltenham","county":"Gloucestershire","postcode":"GL3 4HT"},
                {"buildingNumber":"29","streetName":"Falcon Street","locality":"Ridgebury","postTown":"Worcester","county":"Worcestershire","postcode":"WR1 6JS"},
                {"buildingNumber":"16","streetName":"Harrier Way","locality":"Loxwood Green","postTown":"Horsham","county":"West Sussex","postcode":"RH13 7BN"},

                {"buildingNumber":"33","streetName":"Yew Tree Court","locality":"Silverbrook","postTown":"Shrewsbury","county":"Shropshire","postcode":"SY2 8RR"},
                {"buildingNumber":"4","streetName":"Osprey Road","locality":"Heathwick","postTown":"Birmingham","county":"West Midlands","postcode":"B15 8RT"},
                {"buildingNumber":"22","streetName":"Stonemill Drive","locality":"Hawkinge Vale","postTown":"Canterbury","county":"Kent","postcode":"CT3 6LW"},
                {"buildingNumber":"9","streetName":"Willowbank Way","locality":"East Harling","postTown":"Ipswich","county":"Suffolk","postcode":"IP5 0YN"},
                {"buildingNumber":"56","streetName":"Sandpiper Crescent","locality":"Cove Hill","postTown":"Southampton","county":"Hampshire","postcode":"SO9 7MC"},
                {"buildingNumber":"15","streetName":"Beacon Lane","locality":"Craybourne","postTown":"Maidstone","county":"Kent","postcode":"ME16 2RS"},
                {"buildingNumber":"101","streetName":"Elm Walk","locality":"Hillford","postTown":"Harlow","county":"Essex","postcode":"CM19 6JQ"},
                {"buildingNumber":"2","streetName":"Clearwater Road","locality":"Riverside","postTown":"Colchester","county":"Essex","postcode":"CO5 3LP"},
                {"buildingNumber":"48","streetName":"Lavender Street","locality":"Westford","postTown":"Cambridge","county":"Cambridgeshire","postcode":"CB3 9UE"},
                {"buildingNumber":"72","streetName":"Greyfriars Way","locality":"Bellstead","postTown":"Bedford","county":"Bedfordshire","postcode":"MK41 1RF"},

                {"buildingNumber":"36","streetName":"Highcliff Road","locality":"Marshgate","postTown":"Grimsby","county":"Lincolnshire","postcode":"DN3 7NS"},
                {"buildingNumber":"88","streetName":"Fenton Close","locality":"Broadwood","postTown":"Sheffield","county":"South Yorkshire","postcode":"S11 6TB"},
                {"buildingNumber":"41","streetName":"Tansy Court","locality":"Littlebourne","postTown":"Canterbury","county":"Kent","postcode":"CT4 1JX"},
                {"buildingNumber":"97","streetName":"Sunnyside Avenue","locality":"Greenleigh","postTown":"Leeds","county":"West Yorkshire","postcode":"LS7 2PQ"},
                {"buildingNumber":"30","streetName":"Larch Lane","locality":"Warren Hill","postTown":"Hull","county":"East Yorkshire","postcode":"HU6 4ZY"},
                {"buildingNumber":"62","streetName":"Poppyfield Way","locality":"Marston Ridge","postTown":"Oxford","county":"Oxfordshire","postcode":"OX4 7GE"},
                {"buildingNumber":"21","streetName":"Ivywood Street","locality":"Southmere","postTown":"Cardiff","county":"South Glamorgan","postcode":"CF5 2JD"},
                {"buildingNumber":"14","streetName":"Oakridge Row","locality":"Firrendown","postTown":"Swansea","county":"West Glamorgan","postcode":"SA6 8PP"},
                {"buildingNumber":"81","streetName":"Bridgewater Drive","locality":"Lancot Green","postTown":"Luton","county":"Bedfordshire","postcode":"LU4 9WB"},
                {"buildingNumber":"26","streetName":"Primrose Lane","locality":"Wickford Heath","postTown":"Basildon","county":"Essex","postcode":"SS14 3SR"},

                {"buildingNumber":"59","streetName":"Regent Gardens","locality":"Kingsreach","postTown":"Coventry","county":"West Midlands","postcode":"CV3 1BN"},
                {"buildingNumber":"18","streetName":"Myrtle Row","locality":"Oldacre","postTown":"Warrington","county":"Cheshire","postcode":"WA3 2XT"},
                {"buildingNumber":"6","streetName":"Wisteria Court","locality":"Cresthaven","postTown":"St Albans","county":"Hertfordshire","postcode":"AL4 8FJ"},
                {"buildingNumber":"85","streetName":"Sparrow Lane","locality":"Northwood Vale","postTown":"Watford","county":"Hertfordshire","postcode":"WD24 6PH"},
                {"buildingNumber":"11","streetName":"Ashen Close","locality":"Brookhill","postTown":"Slough","county":"Berkshire","postcode":"SL2 9MT"},
                {"buildingNumber":"53","streetName":"Laurel Drive","locality":"Kingswood Park","postTown":"Bristol","county":"Bristol","postcode":"BS16 4DX"},
                {"buildingNumber":"7","streetName":"Thornfield Way","locality":"Greenhollow","postTown":"Gloucester","county":"Gloucestershire","postcode":"GL1 5UP"},
                {"buildingNumber":"40","streetName":"Cedar Brook","locality":"Ashvale","postTown":"High Wycombe","county":"Buckinghamshire","postcode":"HP12 8PD"},
                {"buildingNumber":"98","streetName":"Stag Lane","locality":"Marbleham","postTown":"Brighton","county":"East Sussex","postcode":"BN2 1WE"},
                {"buildingNumber":"27","streetName":"Whistler Road","locality":"East Densford","postTown":"Portsmouth","county":"Hampshire","postcode":"PO4 7JF"},

                {"buildingNumber":"75","streetName":"Gorse Way","locality":"Heathrow End","postTown":"Hounslow","county":"Greater London","postcode":"TW4 5ZA"},
                {"buildingNumber":"3","streetName":"Juniper Walk","locality":"Woodleigh","postTown":"Enfield","county":"Greater London","postcode":"EN3 1TP"},
                {"buildingNumber":"58","streetName":"Chapel Row","locality":"Millthorpe","postTown":"Wakefield","county":"West Yorkshire","postcode":"WF3 8KD"},
                {"buildingNumber":"13","streetName":"Stonewall Lane","locality":"Northbridge","postTown":"Bradford","county":"West Yorkshire","postcode":"BD7 5TE"},
                {"buildingNumber":"60","streetName":"Queensbury Court","locality":"Palmstead","postTown":"Blackpool","county":"Lancashire","postcode":"FY2 9AH"},
                {"buildingNumber":"17","streetName":"Buttercup Close","locality":"Little Havers","postTown":"Stevenage","county":"Hertfordshire","postcode":"SG2 0YG"},
                {"buildingNumber":"92","streetName":"Meadowbank Road","locality":"Harefield Park","postTown":"Liverpool","county":"Merseyside","postcode":"L8 6FP"},
                {"buildingNumber":"39","streetName":"Arbour Road","locality":"Phoenix Rise","postTown":"Manchester","county":"Greater Manchester","postcode":"M14 2YQ"},
                {"buildingNumber":"4","streetName":"Cherrytree Court","locality":"Stonemoor","postTown":"Stockport","county":"Greater Manchester","postcode":"SK4 3EW"},
                {"buildingNumber":"66","streetName":"Fieldhouse Lane","locality":"Greywood","postTown":"Bolton","county":"Greater Manchester","postcode":"BL3 9HB"},

                {"buildingNumber":"20","streetName":"Honeysuckle Way","locality":"Oakwood Hill","postTown":"Preston","county":"Lancashire","postcode":"PR3 8LN"},
                {"buildingNumber":"95","streetName":"Old Forge Street","locality":"Daleham","postTown":"Carlisle","county":"Cumbria","postcode":"CA2 5NJ"},
                {"buildingNumber":"43","streetName":"Nightingale Row","locality":"Brambleton","postTown":"Durham","county":"County Durham","postcode":"DH1 3GP"},
                {"buildingNumber":"10","streetName":"Redwood Close","locality":"Southholm","postTown":"Sunderland","county":"Tyne and Wear","postcode":"SR3 1FQ"},
                {"buildingNumber":"86","streetName":"Copse Lane","locality":"Hillmead","postTown":"Newcastle","county":"Tyne and Wear","postcode":"NE5 2PA"},
                {"buildingNumber":"31","streetName":"Wildflower Road","locality":"Whitestone","postTown":"Darlington","county":"County Durham","postcode":"DL2 6MX"},
                {"buildingNumber":"47","streetName":"Cloverbank Court","locality":"Iverston","postTown":"Middlesbrough","county":"North Yorkshire","postcode":"TS4 1WW"},
                {"buildingNumber":"6","streetName":"Brookview Way","locality":"Langwood","postTown":"Harrogate","county":"North Yorkshire","postcode":"HG3 9QL"},
                {"buildingNumber":"52","streetName":"Warren Terrace","locality":"Elmwick","postTown":"Scarborough","county":"North Yorkshire","postcode":"YO14 2JG"},
                {"buildingNumber":"1","streetName":"Foxglove Lane","locality":"Brindlehurst","postTown":"Lancaster","county":"Lancashire","postcode":"LA3 7UH"}
              ];

              //
              // INIT FUNCTION
              //
              function _init(){

                const patientsButton = document.querySelector('#patientsButton');
                const patientsTextarea = document.querySelector('#patientsTextarea');

                patientsButton.addEventListener('click',function( e ){
                  
                  console.log('Button clicked');

                  patientsTextarea.value = _generatePatientData();

                  e.preventDefault();
                  e.stopPropagation();

                });

              };

              //
              // GENERATE PATIENT DATA FUNCTION
              //
              function _generatePatientData(){

                const patients = [];

                const certificateTypes = document.querySelector('#certificateTypes').innerHTML.split(',');
                const statuses = ['processing','reviewing','accepted','active','expired'];

                names.forEach( function( name, i ){

                    const obj = name;

                    obj.nhsNumber = _generateNHSNumber();
                    obj.certificateType = certificateTypes[Math.round(Math.random())*(certificateTypes.length-1)];
                    obj.status = ( obj.certificateType === 'hrtppc' ) ? 'active' : statuses[Math.round(Math.random()*(statuses.length-1))];
                    obj.certificateReference = _generateCertificateReference( obj.certificateType, obj.status );

                    obj.startDate = _generateStartDate();
                    obj.endDate = _generateEndDate( obj.startDate );
                    
                    obj.address = ( addresses.length > i ) ? addresses[i] : addresses[Math.round(Math.random()*(addresses.length-1))];

                    patients.push(obj);

                });

                return JSON.stringify( patients );

              };

              //
              // GENERATE IMAGE REFERENCE FUNCTION
              //
              function _generateImageReference(){

                const now = new Date();

                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, "0");
                const day = String(now.getDate()).padStart(2, "0");
                const hours = String(now.getHours()).padStart(2, "0");
                const minutes = String(now.getMinutes()).padStart(2, "0");
                const seconds = String(now.getSeconds()).padStart(2, "0");

                // Generate a 9-digit random number (like 3000049 in your example, but fixed to 9 digits)
                const randomNum = String(Math.floor(Math.random() * 1_000_000_000)).padStart(9, "0");

                return `${year} ${month} ${day} ${hours} ${minutes} ${seconds}N${randomNum}`;

              }

              //
              // GENERATE CERTIFICATE REFERENCE FUNCTION
              //
              function _generateCertificateReference( certificateType, certificateStatus ){

                let chars = [];
                let loop = 0;
                let spaces = [];
                let char = '';
                let az09 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'.split('');

                switch( certificateType ) {
                  
                  case 'matex':

                    loop = (12 + 3) - 1; // 12 digits and 3 spaces
                    spaces = [2,6,10];

                    for( let i = 0; i < loop; i++ ){  
                      char = ( spaces.indexOf(i) > -1 ) ? ' ' : Math.floor( Math.random() * 10 );
                      chars.push( char );
                    }
                    
                    break;

                  case 'hrtppc':

                    chars = ['HRT ']; // Always start with HRT
                    loop = ( 8 + 1 ); // 8 characters and 1 space
                    spaces = [4];

                    

                    for( let i = 0; i < loop; i++ ){ 
                      char = ( spaces.indexOf(i) > -1 ) ? ' ' : az09[Math.round(Math.random()*(az09.length-1))];
                      chars.push( char );
                    }


                    break;

                }

                let ref = chars.join('');

                // Override for processing status
                if( certificateType === 'matex' && certificateStatus === 'processing' ){
                  ref = _generateImageReference();
                }
              
               return ref;

              };

              //
              // GENERATE NHS NUMBER FUNCTION
              //
              function _generateNHSNumber() {

                // Format 000 000 0000
                const digits = [];
                const loop = (10 + 2) - 1; // 10 digits and 2 spaces

                for( let i = 0; i < loop; i++ ){
                  
                  const spaces = [3,7];
                  const char = ( spaces.indexOf(i) > -1 ) ? ' ' : Math.floor( Math.random() * 10 );
                  digits.push( char );

                }

                return digits.join('');

              };

              //
              // GENERATE START DATE
              //
              function _generateStartDate(){

                const today = new Date();
                
                const minMonths = -6;
                const maxMonths = -12;

                // Create date bounds
                const minDate = new Date();
                minDate.setMonth(minDate.getMonth() + minMonths);
                minDate.setHours(0, 0, 0, 0);

                const maxDate = new Date();
                maxDate.setMonth(maxDate.getMonth() + maxMonths);
                maxDate.setHours(0, 0, 0, 0);

                // Pick a random date between them
                const randomTime = minDate.getTime() + Math.random() * (maxDate.getTime() - minDate.getTime());
                const randomDate = new Date(randomTime);

                // Format: "1 November 2023"
                const day = randomDate.getDate();
                const month = randomDate.toLocaleString('en-GB', { month: 'long' });
                const year = randomDate.getFullYear();

                return day + ' ' + month + ' ' + year;

              };

              //
              // GENERATE END DATE FUNCTION
              //
              function _generateEndDate( startDateString ){

                const startDate = new Date( startDateString );
                startDate.setMonth( startDate.getMonth() + 21 );
                startDate.setHours(0, 0, 0, 0);

                const day = startDate.getDate();
                const month = startDate.toLocaleString('en-GB', { month: 'long' });
                const year = startDate.getFullYear();

                return day + ' ' + month + ' ' + year;

              };


              

              return {
                init: _init
              }

            })();

            document.addEventListener('DOMContentLoaded',function(){
              DataGenerator.init();
            });

          </script>

</div>
</div>


  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-two-thirds">



          {{ textarea({
            id: 'patientsTextarea',
            label: {
              text: 'Patient data',
              classes: 'nhsuk-label--m'
            },
            hint: {
              html: '
                <p>Press the button below to generate a fresh set of patient data with JS, that can be copy/pasted and added into the static patientData variable held in the nunjucks on this page.</p>
                <p>This is then used to populate the dynamic results table above, and imported into other prototype pages.</p>'
            }
          }) }}

          {{ button({
            id: 'patientsButton',
            text: 'Generate new data'
          }) }}

      </div>
  </div>

{% endblock %}